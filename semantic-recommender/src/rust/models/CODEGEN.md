# Generated Types - Do Not Edit

This directory contains auto-generated Rust types from the OWL ontology.

## File: `generated.rs`

**⚠️ DO NOT EDIT THIS FILE MANUALLY ⚠️**

This file is automatically generated at build time by `build.rs` from:
```
../../design/ontology/expanded-media-ontology.ttl
```

Any manual changes will be **overwritten** on the next build.

## To Make Changes

### Update the Ontology

Edit the source ontology:
```bash
vim ../../design/ontology/expanded-media-ontology.ttl
```

### Rebuild

The build script will automatically regenerate types:
```bash
cargo clean
cargo build
```

### Verify

Check that types were regenerated:
```bash
git diff models/generated.rs
```

## What Gets Generated

The build script extracts these OWL class hierarchies and generates Rust enums:

| Ontology Class | Rust Enum | Variants | Use Case |
|----------------|-----------|----------|----------|
| `media:Genre` | `Genre` | 8 | Content classification |
| `media:VisualAesthetic` | `VisualAesthetic` | 4 | GPU-derived color grading |
| `media:NarrativeStructure` | `NarrativeStructure` | 4 | Story structure analysis |
| `media:Mood` | `Mood` | 4 | Audio-visual mood detection |
| `media:Pacing` | `Pacing` | 3 | Motion/cut frequency metrics |

## Generated Code Features

Each enum includes:

✅ **Serde serialization** with proper rename attributes
✅ **Display implementation** for human-readable output
✅ **OWL URI mapping** (bidirectional)
✅ **OntologyMappable trait** implementation
✅ **Full documentation** from ontology comments

## Example Generated Code

```rust
#[derive(Debug, Clone, Copy, PartialEq, Eq, Hash, Serialize, Deserialize)]
pub enum Genre {
    Action,
    #[serde(rename = "Science Fiction")]
    SciFi,
    // ... more variants
}

impl Genre {
    pub fn to_owl_uri(&self) -> &'static str { /* ... */ }
    pub fn from_owl_uri(uri: &str) -> Option<Self> { /* ... */ }
}

impl fmt::Display for Genre { /* ... */ }
impl OntologyMappable for Genre { /* ... */ }
```

## Build Script Details

**Location:** `../build.rs`

**Process:**
1. Parse TTL file line-by-line (no external dependencies)
2. Extract `@prefix` declarations for URI expansion
3. Find all `owl:Class` definitions
4. Parse `rdfs:subClassOf` relationships
5. Extract `rdfs:label` and `rdfs:comment` for documentation
6. Group classes by parent to create enum hierarchies
7. Generate Rust code with all implementations
8. Write to `models/generated.rs`

**Trigger:**
```toml
[build-dependencies]
# Uses std lib only - no external crates needed
```

The script runs automatically when:
- `cargo build` is executed
- TTL file timestamp changes
- `generated.rs` is deleted

## Integration

Import generated types:
```rust
use crate::models::generated::{
    Genre, VisualAesthetic, NarrativeStructure,
    Mood, Pacing, OntologyMappable
};
```

Or use through re-exports:
```rust
use crate::models::{Genre, VisualAesthetic};
```

## Validation

Tests verify synchronization:
```bash
cargo test --test ontology_rust_sync_test
```

These tests check:
- Bidirectional URI mapping works
- All variants are present
- Serialization is correct
- Display formatting matches labels
- Exhaustive pattern matching

## Troubleshooting

### Build Fails

**Error:** `Failed to open ontology file`
```bash
# Verify ontology exists
ls -la ../../design/ontology/expanded-media-ontology.ttl
```

**Error:** `Failed to create generated.rs`
```bash
# Check permissions
ls -la models/
chmod +w models/
```

### Types Missing

If expected types aren't generated:
1. Check ontology has `rdfs:subClassOf` relationships
2. Verify parent class name matches expected pattern
3. Check build script console output:
   ```
   cargo build 2>&1 | grep "Generated Rust types"
   ```

### Manual Override Needed

If you **must** manually edit generated code (strongly discouraged):
1. Copy `generated.rs` to `generated_custom.rs`
2. Update `mod.rs` to use custom file
3. Disable build script regeneration:
   ```toml
   # In Cargo.toml, remove build-dependencies
   ```
4. **Document why** in git commit

## Version Info

Generated types version: **Based on ontology v2.0 (2025-12-04)**

Run `git log --oneline design/ontology/expanded-media-ontology.ttl` to see ontology change history.

## See Also

- Main documentation: `/docs/ontology-type-generation.md`
- Ontology source: `/design/ontology/expanded-media-ontology.ttl`
- Build script: `../build.rs`
- Tests: `/tests/ontology_rust_sync_test.rs`
